!function(){var o=angular.module("choreIt",["ui.router"]);o.config(["$stateProvider","$urlRouterProvider",function(o,e){o.state("home",{url:"/home",templateUrl:"/home.html",controller:"MainCtrl",controllerAs:"main",resolve:{groupPromise:["chores",function(o){return o.getAllGroups()}]}}).state("login",{url:"/login",templateUrl:"/login.html",controller:"AuthCtrl",controllerAs:"auth",onEnter:["$state","auth",function(o,e){e.isLoggedIn()&&o.go("home")}]}).state("register",{url:"/register",templateUrl:"/register.html",controller:"AuthCtrl",controllerAs:"auth",onEnter:["$state","auth",function(o,e){e.isLoggedIn()&&o.go("home")}]}),e.otherwise("home")}])}(),function(){var o=angular.module("choreIt");o.controller("AuthCtrl",["$state","auth",function(o,e){var t=this;t.user={},t.register=function(){e.register(t.user)["catch"](function(o){t.error=o,console.log(o)}).then(function(){t.error||o.go("home")})},t.logIn=function(){e.logIn(t.user)["catch"](function(o){t.error=o,console.log(o.data.message)}).then(function(){t.error||o.go("home")})}}])}(),function(){var o=angular.module("choreIt");o.factory("auth",["$window","$http",function(o,e){var t={};return t.getToken=function(){return o.localStorage["choreIt-token"]},t.saveToken=function(e){o.localStorage["choreIt-token"]=e},t.logOut=function(){o.localStorage.removeItem("choreIt-token")},t.register=function(o){return e.post("/register",o).then(function(o){o.data.token&&t.saveToken(o.data.token)})},t.logIn=function(o){return console.log(o),e.post("/login",o).then(function(o){o.data.token&&t.saveToken(o.data.token)})},t.isLoggedIn=function(){var e=t.getToken();if(e){var r=JSON.parse(o.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}return!1},t.currentUser=function(){if(t.isLoggedIn()){var e=t.getToken(),r=JSON.parse(o.atob(e.split(".")[1]));return r.username}},t}])}(),function(){angular.module("choreIt")}(),function(){var o=angular.module("choreIt");o.factory("chores",["$http","auth",function(o,e){var t={groups:[]};return t.getAllGroups=function(){return o.get("/groups",{headers:{Authorization:"Bearer "+e.getToken()}}).then(function(o){angular.copy(o.data,t.groups)})},t.addGroup=function(r){return o.post("/groups",r,{headers:{Authorization:"Bearer "+e.getToken()}}).then(function(o){t.groups.push(o.data)})},t.deleteGroup=function(t){return o["delete"]("/groups/"+t,{headers:{Authorization:"Bearer "+e.getToken()}})},t.addChore=function(t,r){return o.post("/groups/"+t+"/chore",r,{headers:{Authorization:"Bearer "+e.getToken()}})},t}])}(),function(){var o=angular.module("choreIt");o.controller("MainCtrl",["$scope","chores","auth",function(o,e,t){var r=this;r.groups=e.groups,r.groups&&(r.activeGroup=r.groups[0]),r.setActiveGroup=function(o){r.activeGroup=o},r.addChore=function(){var o=r.activeGroup._id;e.addChore(o,{body:r.newChore}).then(function(o){r.activeGroup.chores.push(o.data)}),r.newChore=""},r.toggleComplete=function(o){o.complete=!o.complete},r.addGroup=function(){if(console.log(r.newGroup),r.newGroup&&""!=r.newGroup){var o={};t.isLoggedIn()?(o.title=r.newGroup,o.username=t.currentUser(),e.addGroup(o),r.newGroup=""):console.log("You must be logged in to add a group")}},r.deleteGroup=function(o){e.deleteGroup(o._id).then(function(){console.dir(r.groups.indexOf(o)),r.groups.splice(r.groups.indexOf(o),1),o==r.activeGroup&&(r.activeGroup=null)})}}])}(),function(){var o=angular.module("choreIt");o.controller("NavCtrl",["auth",function(o){var e=this;e.isLoggedIn=o.isLoggedIn,e.currentUser=o.currentUser,e.logOut=o.logOut}])}();