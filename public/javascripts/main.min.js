!function(){var e=angular.module("choreIt",["ui.router"]);e.config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("home",{url:"/home",templateUrl:"/home.html",controller:"MainCtrl",controllerAs:"main",onEnter:["auth","$state",function(e,o){e.isLoggedIn()&&o.go("chores")}]}).state("chores",{url:"/chores",templateUrl:"/chores.html",controller:"MainCtrl",controllerAs:"main",resolve:{groupPromise:["chores",function(e){return e.getAllGroups()}]},onEnter:["auth","$state",function(e,o){e.isLoggedIn()||o.go("home")}]}).state("login",{url:"/login",templateUrl:"/login.html",controller:"AuthCtrl",controllerAs:"auth",onEnter:["$state","auth",function(e,o){o.isLoggedIn()&&e.go("home")}]}).state("register",{url:"/register",templateUrl:"/register.html",controller:"AuthCtrl",controllerAs:"auth",onEnter:["$state","auth",function(e,o){o.isLoggedIn()&&e.go("home")}]}),o.otherwise("home")}])}(),function(){var e=angular.module("choreIt");e.controller("AuthCtrl",["$state","auth",function(e,o){var t=this;t.user={},t.register=function(){o.register(t.user)["catch"](function(e){t.error=e,console.log(e)}).then(function(){t.error||e.go("chores")})},t.logIn=function(){o.logIn(t.user)["catch"](function(e){t.error=e,console.log(e.data.message)}).then(function(){t.error||e.go("chores")})}}])}(),function(){var e=angular.module("choreIt");e.factory("auth",["$window","$http","$state",function(e,o,t){var r={};return r.getToken=function(){return e.localStorage["choreIt-token"]},r.saveToken=function(o){e.localStorage["choreIt-token"]=o},r.logOut=function(){e.localStorage.removeItem("choreIt-token"),t.go("home")},r.register=function(e){return o.post("/register",e).then(function(e){e.data.token&&r.saveToken(e.data.token)})},r.logIn=function(e){return console.log(e),o.post("/login",e).then(function(e){e.data.token&&r.saveToken(e.data.token)})},r.isLoggedIn=function(){var o=r.getToken();if(o){var t=JSON.parse(e.atob(o.split(".")[1]));return t.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var o=r.getToken(),t=JSON.parse(e.atob(o.split(".")[1]));return t.username}},r}])}(),function(){var e=angular.module("choreIt");e.factory("chores",["$http","auth",function(e,o){var t={groups:[]};return t.getAllGroups=function(){return e.get("/groups",{headers:{Authorization:"Bearer "+o.getToken()}}).then(function(e){angular.copy(e.data,t.groups)})},t.addGroup=function(r){return e.post("/groups",r,{headers:{Authorization:"Bearer "+o.getToken()}}).then(function(e){return t.groups.push(e.data),e})},t.deleteGroup=function(t){return e["delete"]("/groups/"+t,{headers:{Authorization:"Bearer "+o.getToken()}})},t.addChore=function(t,r){return e.post("/groups/"+t+"/chore",r,{headers:{Authorization:"Bearer "+o.getToken()}})},t.deleteChore=function(t,r){return e["delete"]("/groups/"+t+"/chores/"+r,{headers:{Authorization:"Bearer "+o.getToken()}})},t}])}(),function(){var e=angular.module("choreIt");e.controller("MainCtrl",["$scope","chores","auth",function(e,o,t){function r(e,o){"delete"==e?o==n.activeGroup&&(n.groups.length?n.activeGroup=n.groups[n.groups.length-1]:n.activeGroup=null):"add"==e&&(n.activeGroup||(n.activeGroup=o))}var n=this;n.groups=o.groups,n.groups&&(n.activeGroup=n.groups[0]),n.setActiveGroup=function(e){n.activeGroup=e},n.addChore=function(){var e=n.activeGroup._id;o.addChore(e,{body:n.newChore}).then(function(e){n.activeGroup.chores.push(e.data)}),n.newChore=""},n.toggleComplete=function(e){e.complete=!e.complete},n.addGroup=function(){if(n.newGroup&&""!=n.newGroup){var e={};t.isLoggedIn()?(e.title=n.newGroup,e.username=t.currentUser(),o.addGroup(e).then(function(e){r("add",e.data)}),n.newGroup=""):console.log("You must be logged in to add a group")}},n.deleteGroup=function(e){o.deleteGroup(e._id).then(function(){n.groups.splice(n.groups.indexOf(e),1),r("delete",e)})},n.deleteChore=function(e){var t=n.activeGroup;o.deleteChore(t._id,e._id).then(function(){t.chores.splice(t.chores.indexOf(e),1)})}}])}(),function(){var e=angular.module("choreIt");e.controller("NavCtrl",["auth",function(e){var o=this;o.isLoggedIn=e.isLoggedIn,o.currentUser=e.currentUser,o.logOut=e.logOut}])}();